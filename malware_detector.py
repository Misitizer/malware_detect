import json
import os
import sys

from malware_ml.model import load_model, apply_model_to_json
from malware_ml.prepare_data import DEFAULT_TARGET

DEFAULT_MODEL_PATH = '../models/model.cb'


def change_location():
    script_location = os.path.dirname(os.path.abspath(__file__))
    os.chdir(script_location)


def main():
    change_location()
    print('Send json string to get prediction.')
    input_string = sys.stdin()
    model = load_model(DEFAULT_MODEL_PATH)
    data = json.loads(input_string)
    target = data.get(DEFAULT_TARGET)
    prediction = apply_model_to_json(model, data)
    print(prediction, target)


if __name__ == '__main__':
    main()
